@startuml JB_API_Readable_Diagram

!theme aws-orange
skinparam backgroundColor #f8f9fa
skinparam classAttributeIconSize 0
skinparam classFontStyle bold
skinparam classFontSize 11
skinparam packageFontSize 14
skinparam packageFontStyle bold
skinparam packageBackgroundColor #e3f2fd
skinparam packageBorderColor #1976d2
skinparam classBorderColor #424242
skinparam classBackgroundColor #ffffff
skinparam classHeaderBackgroundColor #e8f5e8
skinparam arrowColor #666666
skinparam arrowFontSize 10
skinparam linetype ortho
skinparam nodesep 80
skinparam ranksep 100

left to right direction

' Core Layer
package "üèóÔ∏è Core State" as core {
    class InnerState {
        - sdk_config: SdkConfig
        - bedrockagent: BedrockClient
        - dynamo: DynamoClient
        - cognito: CognitoClient
    }
}

' Auth Layer
package "üîê Authentication" as auth {
    class AuthorizedUser {
        - sub: Sub
        + sub(): &str
    }
    
    class Sub {
        - value: String
    }
    
    class AssertAdmin
}

' Domain Layer
package "üíæ Domain Models" as domain {
    class Counter {
        + name: String
        + count: u64
        + increment(): u64
    }
    
    class Level {
        + level_id: LevelID
        + name: String
        + prompt_components: Vec<ComponentID>
        + next: Vec<LevelID>
    }
    
    class PromptComponent {
        + component_id: ComponentID
        + template_id: TemplateID
        + ordering: String
        + text: String
    }
    
    class LevelID {
        + id: u64
    }
    
    class ComponentID {
        + id: u64
    }
    
    class TemplateID {
        + id: String
    }
}

' API Layer
package "üåê API Layer" as api {
    
    class ComponentAPI {
        + get_components()
        + add_component()
        + modify_component()
        + move_component()
    }
    
    class LevelAPI {
        + get_levels()
        + create_level()
        + modify_level()
        + delete_level()
    }
    
    class ChatAPI {
        + chat_session()
    }
    
    class ComponentRequest {
        + predecessor: Option<ComponentID>
        + new_text: String
    }
    
    class LevelRequest {
        + name: String
        + components: Vec<ComponentID>
        + next: Vec<LevelID>
    }
    
    class ChatRequest {
        + message: String
    }
}

' Error Layer
package "‚ö†Ô∏è Errors" as errors {
    enum AuthError {
        NotAuthorized
        NotAnAdmin
    }
    
    enum DatabaseError {
        QueryFailed
        CreationFailed
        UpdateFailed
        NotFound
    }
    
    enum ServiceError {
        BedrockFailed
        InvalidResponse
    }
}

' Relationships - Clean and organized
InnerState ..> Level : uses
InnerState ..> PromptComponent : uses
InnerState ..> Counter : uses

AuthorizedUser *-- Sub
AuthorizedUser ..> AssertAdmin

Level *-- LevelID
Level --> ComponentID : references
PromptComponent *-- ComponentID
PromptComponent *-- TemplateID

ComponentAPI ..> PromptComponent : manages
LevelAPI ..> Level : manages
ChatAPI ..> InnerState : uses

ComponentAPI --> ComponentRequest : accepts
LevelAPI --> LevelRequest : accepts
ChatAPI --> ChatRequest : accepts

ComponentAPI --> AuthorizedUser : requires
LevelAPI --> AuthorizedUser : requires
ChatAPI --> AuthorizedUser : requires

note top of InnerState : AWS Service Clients
note bottom of domain : Core Business Logic
note right of api : REST API Endpoints
note left of errors : Error Handling

@enduml